
services:
  # --- Backend Service (FastAPI) ---
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
    environment:
      # CRITICAL FIX: Pass the API key from the host environment into the container.
      # Docker Compose will look for this variable in your shell or in a local .env file.
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      PYTHONUNBUFFERED: 1
    # COMMAND: Run the development server (uvicorn)
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

  # --- Frontend Service (React/Vite) ---
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    # CRITICAL: Mount the local frontend folder into the container's working directory (/app)
    # This allows file changes on your host machine to be instantly reflected in the container.
    volumes:
      - ./frontend:/app
      # Optional: Explicitly mount node_modules outside the sync to prevent issues
      - /app/node_modules
    environment:
      VITE_BACKEND_URL: http://backend:8000
    # CRITICAL: Command to run the Vite development server
    command: npm run dev -- --host 0.0.0.0 --port 5173
    depends_on:
      - backend